{"ast":null,"code":"import { HttpHeaders } from '@angular/common/http';\nimport { BehaviorSubject, tap } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport let AuthService = /*#__PURE__*/(() => {\n  class AuthService {\n    http;\n    apiUrl = '/auth';\n    tokenKey = 'auth_token';\n    userKey = 'current_user';\n    currentUserSubject = new BehaviorSubject(this.getCurrentUser());\n    currentUser$ = this.currentUserSubject.asObservable();\n    constructor(http) {\n      this.http = http;\n    }\n    register(registerRequest) {\n      return this.http.post(`${this.apiUrl}/register`, registerRequest).pipe(tap(response => {\n        if (response.token) {\n          this.setSession(response.token, {\n            username: response.username,\n            email: registerRequest.email\n          });\n        }\n      }));\n    }\n    login(loginRequest) {\n      return this.http.post(`${this.apiUrl}/login`, loginRequest).pipe(tap(response => {\n        if (response.token) {\n          this.setSession(response.token, {\n            username: response.username\n          });\n        }\n      }));\n    }\n    logout() {\n      localStorage.removeItem(this.tokenKey);\n      localStorage.removeItem(this.userKey);\n      this.currentUserSubject.next(null);\n    }\n    isLoggedIn() {\n      const token = this.getToken();\n      if (!token) return false;\n      // Check if token is expired\n      try {\n        const payload = JSON.parse(atob(token.split('.')[1]));\n        const expiry = payload.exp * 1000;\n        return Date.now() < expiry;\n      } catch {\n        return false;\n      }\n    }\n    getToken() {\n      return localStorage.getItem(this.tokenKey);\n    }\n    getCurrentUser() {\n      const userStr = localStorage.getItem(this.userKey);\n      return userStr ? JSON.parse(userStr) : null;\n    }\n    getAuthHeaders() {\n      const token = this.getToken();\n      return new HttpHeaders({\n        'Authorization': token ? `Bearer ${token}` : '',\n        'Content-Type': 'application/json'\n      });\n    }\n    setSession(token, user) {\n      localStorage.setItem(this.tokenKey, token);\n      localStorage.setItem(this.userKey, JSON.stringify(user));\n      this.currentUserSubject.next(user);\n    }\n    static ɵfac = function AuthService_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || AuthService)(i0.ɵɵinject(i1.HttpClient));\n    };\n    static ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AuthService,\n      factory: AuthService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n  return AuthService;\n})();","map":{"version":3,"names":["HttpHeaders","BehaviorSubject","tap","AuthService","http","apiUrl","tokenKey","userKey","currentUserSubject","getCurrentUser","currentUser$","asObservable","constructor","register","registerRequest","post","pipe","response","token","setSession","username","email","login","loginRequest","logout","localStorage","removeItem","next","isLoggedIn","getToken","payload","JSON","parse","atob","split","expiry","exp","Date","now","getItem","userStr","getAuthHeaders","user","setItem","stringify","i0","ɵɵinject","i1","HttpClient","factory","ɵfac","providedIn"],"sources":["/Users/ariez/Downloads/crud/src/app/auth.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { Observable, BehaviorSubject, tap } from 'rxjs';\n\nexport interface User {\n  username: string;\n  email?: string;\n}\n\nexport interface AuthResponse {\n  token: string;\n  username: string;\n  message?: string;\n}\n\nexport interface LoginRequest {\n  username: string;\n  password: string;\n}\n\nexport interface RegisterRequest {\n  username: string;\n  password: string;\n  email: string;\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthService {\n  private apiUrl = '/auth';\n  private tokenKey = 'auth_token';\n  private userKey = 'current_user';\n\n  private currentUserSubject = new BehaviorSubject<User | null>(this.getCurrentUser());\n  public currentUser$ = this.currentUserSubject.asObservable();\n\n  constructor(private http: HttpClient) {}\n\n  register(registerRequest: RegisterRequest): Observable<AuthResponse> {\n    return this.http.post<AuthResponse>(`${this.apiUrl}/register`, registerRequest).pipe(\n      tap(response => {\n        if (response.token) {\n          this.setSession(response.token, { username: response.username, email: registerRequest.email });\n        }\n      })\n    );\n  }\n\n  login(loginRequest: LoginRequest): Observable<AuthResponse> {\n    return this.http.post<AuthResponse>(`${this.apiUrl}/login`, loginRequest).pipe(\n      tap(response => {\n        if (response.token) {\n          this.setSession(response.token, { username: response.username });\n        }\n      })\n    );\n  }\n\n  logout(): void {\n    localStorage.removeItem(this.tokenKey);\n    localStorage.removeItem(this.userKey);\n    this.currentUserSubject.next(null);\n  }\n\n  isLoggedIn(): boolean {\n    const token = this.getToken();\n    if (!token) return false;\n\n    // Check if token is expired\n    try {\n      const payload = JSON.parse(atob(token.split('.')[1]));\n      const expiry = payload.exp * 1000;\n      return Date.now() < expiry;\n    } catch {\n      return false;\n    }\n  }\n\n  getToken(): string | null {\n    return localStorage.getItem(this.tokenKey);\n  }\n\n  getCurrentUser(): User | null {\n    const userStr = localStorage.getItem(this.userKey);\n    return userStr ? JSON.parse(userStr) : null;\n  }\n\n  getAuthHeaders(): HttpHeaders {\n    const token = this.getToken();\n    return new HttpHeaders({\n      'Authorization': token ? `Bearer ${token}` : '',\n      'Content-Type': 'application/json'\n    });\n  }\n\n  private setSession(token: string, user: User): void {\n    localStorage.setItem(this.tokenKey, token);\n    localStorage.setItem(this.userKey, JSON.stringify(user));\n    this.currentUserSubject.next(user);\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}